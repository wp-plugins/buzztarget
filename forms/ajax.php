<?php	/* ************************************************** */	// REGISTER USER	/* ************************************************** */		add_action('wp_ajax_nopriv_buzztarget_ajax_register', 'callback_buzztarget_ajax_register');	add_action('wp_ajax_buzztarget_ajax_register',        'callback_buzztarget_ajax_register');	function callback_buzztarget_ajax_register() {		global $buzztarget_form_field_keys;				// CHECK IF ALL FIELDS ARE SET AND SENT TO SERVER		foreach ($buzztarget_form_field_keys as $ff_key) {			if (!isset($_POST[$ff_key])) {				buzztarget_ajax_response('Sorry we are having difficulties right now. Try again later.', -1);				exit;			}		}		$meta = get_post_meta($id);		$buzztarget_settings = buzztarget_sanizite_meta($meta);		$validation_error_placeholder = '%s field not set properly. Please check your data and try again.';				// VALIDATE FIELDS		foreach ($buzztarget_form_field_keys as $ff_key) {			${$ff_key} = $_POST[$ff_key];			if (isset($buzztarget_settings[$ff_key . '_required']) && $buzztarget_settings[$ff_key . '_required'] === PostMetaManagerHelper::CheckboxChecked && empty(${$ff_key})) {				buzztarget_ajax_response(sprintf($validation_error_placeholder, '"' . $buzztarget_settings[$ff_key . '_label'] . '"'), -1);				exit;			}		}				// REGISTER CONTACT TO API		$data = array(			'email'       => $_POST['email'],			'firstname'   => $_POST['fname'],			'lastname'    => $_POST['lname'],			'companyname' => $_POST['cname'],			'title'       => $_POST['title'],			'phone'       => $_POST['phoneno']		);				// GET API CREDENTIALS		$options = get_option('repl_options');		$api_user_token = $options['api_user_token'];		$api_key = $options['api_key'];		$api_secret_key = $options['api_secret_key'];				$request_url = sprintf(BUZZTARGET_API_URL_PLACEHOLDER, $api_user_token);		$ch = curl_init();		curl_setopt($ch, CURLOPT_URL, $request_url);		curl_setopt($ch, CURLOPT_POST, true);		curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);		curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));		curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);		curl_setopt($ch, CURLOPT_HTTPHEADER, array(			'Cache-Control: no-cache',			'Content-Type: application/json; charset=utf-8',			'Authorization-ApiKey: ' . $api_key,			'Authorization-ApiSecretKey: ' . $api_secret_key		));		 		$result = curl_exec($ch);		$status = curl_getinfo($ch, CURLINFO_HTTP_CODE);				if (curl_errno($ch)) {			print curl_error($ch);			exit;		} else {			curl_close($ch);		}				if ($status == 200 && !empty($result)) {			$result = json_decode($result, true);			if (!empty($result) 				&& is_array($result) 				&& isset($result['Result']) 				&& isset($result['Result']['IsSubscribed']) 				&& $result['Result']['IsSubscribed'] == true) {				buzztarget_ajax_response('Thank You.', 1);				exit;			} else {				buzztarget_ajax_response('Sorry we are having difficulties right now. Try again later.', -1);				exit;			}		}				buzztarget_ajax_response('Sorry we are having difficulties right now. Try again later.', -1);		exit;	}?>